webpackJsonp([3],{Qrm1:function(e,t){},hWTX:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("Xxa5"),o=n.n(a),s=n("exGp"),i=n.n(s),r=n("P9l9"),c={name:"model",props:{lat:"",lng:""},data:function(){return{topic:"",content:"",hasAlert:!1,alertText:"",info:""}},methods:{selectImgs:function(){var e=new FileReader,t=this.$refs.file.files;if(t){var n=e.readAsDataURL(t);console.log(n),e.onload=function(t){21e5<e.result.length?alert("上传失败，请上传不大于2M的图片！"):alert(e.result)}}},close:function(){this.$emit("close")},confirm:function(){var e=this;return i()(o.a.mark(function t(){var n,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={topic:e.topic,content:e.content,lat:e.lat,lng:e.lng},t.next=3,r.a.sendPoint(n);case 3:(a=t.sent).tip?(e.hasAlert=!0,e.alertText=a.tip):"成功"!==a.data.response.message&&(e.hasAlert=!0,e.alertText=a.data.response.message),e.$emit("makePoint");case 6:case"end":return t.stop()}},t,e)}))()}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fullScream"},[n("div",{staticClass:"model"},[n("div",{staticClass:"modelCenter"},[n("div",[n("label",{attrs:{for:"topic"}},[e._v("名称")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.topic,expression:"topic"}],attrs:{name:"topic",id:"topic",type:"text"},domProps:{value:e.topic},on:{input:function(t){t.target.composing||(e.topic=t.target.value)}}})]),e._v(" "),n("hr"),e._v(" "),n("div",[n("label",{attrs:{for:"content"}}),e._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],attrs:{placeholder:"输入文字...",name:"content",id:"content",type:"text"},domProps:{value:e.content},on:{input:function(t){t.target.composing||(e.content=t.target.value)}}})]),e._v(" "),n("input",{ref:"file",attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:function(t){return e.selectImgs()}}})]),e._v(" "),n("div",{staticClass:"modelFoot",attrs:{align:"center"}},[n("button",{staticClass:"close",on:{click:e.confirm}},[e._v("确认")]),e._v(" "),n("button",{staticClass:"close",on:{click:e.close}},[e._v("关闭")])])])])},staticRenderFns:[]};var p=n("VU/8")(c,l,!1,function(e){n("Qrm1")},"data-v-b73a8676",null).exports,d=n("Za1Y"),v={name:"PointInfo",components:{alertTip:d.a},data:function(){return{watcher:!0,editTopic:this.pointInfo.data.topic,editContent:this.pointInfo.data.content,hasAlert:"",alertText:""}},props:{pointInfo:{type:Object}},methods:{closeAlert:function(){this.hasAlert=!1},close:function(){this.$emit("closePointMessage")},edit:function(){this.watcher=!1},changeWatcher:function(){this.watcher=!0},deletePoint:function(){this.$emit("deletePoint"),this.close()},sendNewPoint:function(){var e=this;return i()(o.a.mark(function t(){var n,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={topic:e.editTopic,content:e.editContent},t.next=3,r.a.sendNewPoint(n);case 3:(a=t.sent).tip?(e.hasAlert=!0,e.alertText=a.tip):"成功"!==a.response.message?(e.hasAlert=!0,e.alertText=a.response.message):"成功"===a.response.message&&e.$emit("closePointMessage");case 5:case"end":return t.stop()}},t,e)}))()}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fullScream"},[n("div",{staticClass:"model"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}]},[n("div",{staticClass:"topic"},[e._v(e._s(e.pointInfo.data.topic))]),e._v(" "),n("div",{staticClass:"content"},[e._v(e._s(e.pointInfo.data.content))])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}]},[n("div",[n("label",{attrs:{for:"topic"}},[e._v("标题")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editTopic,expression:"editTopic"}],attrs:{name:"topic",id:"topic",type:"text"},domProps:{value:e.editTopic},on:{input:function(t){t.target.composing||(e.editTopic=t.target.value)}}})]),e._v(" "),n("div",[n("label",{attrs:{for:"content"}},[e._v("内容")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editContent,expression:"editContent"}],attrs:{name:"content",id:"content",type:"text"},domProps:{value:e.editContent},on:{input:function(t){t.target.composing||(e.editContent=t.target.value)}}})])]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.close}},[e._v("关闭")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.edit}},[e._v("编辑")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}],on:{click:e.sendNewPoint}},[e._v("确定")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}],on:{click:e.changeWatcher}},[e._v("取消")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.deletePoint}},[e._v("删除")])]),e._v(" "),n("alertTip",{directives:[{name:"show",rawName:"v-show",value:e.hasAlert,expression:"hasAlert"}],attrs:{"alert-text":e.alertText},on:{closeAlert:e.closeAlert}})],1)},staticRenderFns:[]};var h={name:"makePoint",components:{PointInfo:n("VU/8")(v,m,!1,function(e){n("vdFE")},"data-v-4208f2fc",null).exports,AlertTip:d.a,Model:p},data:function(){return{map:"",hasModel:!1,point_lng:"",point_lat:"",hasAlert:"",alertText:"",hasPointMessage:!1,pointInfo:"",markerName:"",pointId:""}},mounted:function(){this.map=new BMap.Map("map"),this.map.centerAndZoom(new BMap.Point(116.404,39.915),11),this.map.enableScrollWheelZoom(!0)},methods:{close:function(){this.hasModel=!1,this.hasAlert=!1,this.hasPointMessage=!1,this.map.removeEventListener("click",this.showInfo)},showInfo:function(e){this.hasModel=!0,this.point_lng=e.point.lng,this.point_lat=e.point.lat},sendPoint:function(){this.$store.state.hasLogin?this.map.addEventListener("click",this.showInfo):(this.hasAlert=!0,this.alertText="请先登录")},makePoint:function(){this.hasModel=!1,this.autoPoint(),this.map.removeEventListener("click",this.showInfo)},deletePoint:function(){var e=this;return i()(o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.deletePoint(e.pointId);case 2:(n=t.sent).tip?(e.hasAlert=!0,e.alertText=n.tip):"成功"!==n.response.message?(e.hasAlert=!0,e.alertText=n.response.message):"成功"===n.response.message&&e.map.removeOverlay(e.markerName);case 4:case"end":return t.stop()}},t,e)}))()},getOnePoint:function(e){var t=this;return i()(o.a.mark(function n(){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.a.getOnePoint(e);case 2:t.pointInfo=n.sent,t.pointInfo.tip?(t.hasAlert=!0,t.alertText=t.pointInfo.tip):"成功"!==t.pointInfo.response.message&&(t.hasAlert=!0,t.alertText=t.pointInfo.response.message),t.hasPointMessage=!0;case 5:case"end":return n.stop()}},n,t)}))()},autoPoint:function(){var e=this;return i()(o.a.mark(function t(){var n,a,s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.getAllPoint();case 2:for((n=t.sent).tip?(e.hasAlert=!0,e.alertText=n.tip):"成功"!==n.response.message&&(e.hasAlert=!0,e.alertText=n.response.message),a=function(t){var a=n.data[t].id;a=new BMap.Marker(new BMap.Point(n.data[t].lng,n.data[t].lat)),e.map.addOverlay(a),a.addEventListener("click",function(){e.getOnePoint(n.data[t].id),e.pointId=n.data[t].id,e.markerName=a})},s=0;s<n.data.length;s++)a(s);case 6:case"end":return t.stop()}},t,e)}))()}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"makePoint"},[n("div",{attrs:{id:"map"}}),e._v(" "),n("div",{staticClass:"makePointButton"},[n("button",{attrs:{id:"makePoint"},on:{click:e.sendPoint}},[e._v("创建标注")])]),e._v(" "),n("model",{directives:[{name:"show",rawName:"v-show",value:e.hasModel,expression:"hasModel"}],attrs:{lat:e.point_lat,lng:e.point_lng},on:{close:e.close,makePoint:e.makePoint}}),e._v(" "),n("AlertTip",{directives:[{name:"show",rawName:"v-show",value:e.hasAlert,expression:"hasAlert"}],attrs:{"alert-text":e.alertText},on:{closeAlert:e.close}}),e._v(" "),e.hasPointMessage?n("pointInfo",{attrs:{pointInfo:e.pointInfo},on:{closePointMessage:e.close,deletePoint:e.deletePoint}}):e._e()],1)},staticRenderFns:[]};var f=n("VU/8")(h,u,!1,function(e){n("mryj")},"data-v-51aba71c",null);t.default=f.exports},mryj:function(e,t){},vdFE:function(e,t){}});
//# sourceMappingURL=3.2fa02f70fbb6577c06c1.js.map