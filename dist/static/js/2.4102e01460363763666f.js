webpackJsonp([2],{"5VmE":function(e,t){},"9Jd5":function(e,t){e.exports="data:image/png;base64,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"},JRQ9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("Xxa5"),s=n.n(a),i=n("exGp"),o=n.n(i),r=n("Dd8w"),c=n.n(r),l=n("PFOP"),d=n("P9l9"),p=n("Za1Y"),u=n("qOqC"),v=n("2bvH"),m={name:"watchPoint",components:{PointInfo:u.a,AlertTip:p.a,Model:l.a},data:function(){return{map:"",hasModel:!1,point_lng:"",point_lat:"",hasAlert:"",alertText:"",hasPointMessage:!1,pointInfo:"",markerName:"",pointId:"",infoBox:""}},mounted:function(){this.map=new BMap.Map("watchMap"),this.map.centerAndZoom(new BMap.Point(116.404,39.915),5),this.map.enableScrollWheelZoom(!0),this.changeRoute("watchPoint"),this.autoPoint(),this.getInfoBox()},methods:c()({},Object(v.b)(["changeRoute"]),{close:function(){this.hasModel=!1,this.hasAlert=!1,this.hasPointMessage=!1,this.map.removeEventListener("click",this.showInfo)},getInfoBox:function(){var e=this;return o()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.getInfoBox();case 2:e.infoBox=t.sent,e.infoBox.tip?(e.hasAlert=!0,e.alertText=e.pointInfo.tip):e.infoBox.status&&(e.hasAlert=!0,e.alertText=e.infoBox.message);case 4:case"end":return t.stop()}},t,e)}))()},getOnePoint:function(e){var t=this;return o()(s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.getOnePoint(e);case 2:t.pointInfo=n.sent,t.pointInfo.tip?(t.hasAlert=!0,t.alertText=t.pointInfo.tip):"成功"!==t.pointInfo.response.message&&(t.hasAlert=!0,t.alertText=t.pointInfo.response.message),t.hasPointMessage=!0;case 5:case"end":return n.stop()}},n,t)}))()},deletePoint:function(){var e=this;return o()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.deletePoint(e.pointId);case 2:(n=t.sent).tip?(e.hasAlert=!0,e.alertText=n.tip):"成功"!==n.response.message?(e.hasAlert=!0,e.alertText=n.response.message):"成功"===n.response.message&&e.map.removeOverlay(e.markerName);case 4:case"end":return t.stop()}},t,e)}))()},autoPoint:function(){var e=this;return o()(s.a.mark(function t(){var n,a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.getAllPoint();case 2:for((n=t.sent).tip?(e.hasAlert=!0,e.alertText=n.tip):"成功"!==n.response.message&&(e.hasAlert=!0,e.alertText=n.response.message),a=function(t){var a=n.data[t].id;a=new BMap.Marker(new BMap.Point(n.data[t].lng,n.data[t].lat)),e.map.addOverlay(a),a.addEventListener("click",function(){e.getOnePoint(n.data[t].id),e.pointId=n.data[t].id,e.markerName=a})},i=0;i<n.data.length;i++)a(i);case 6:case"end":return t.stop()}},t,e)}))()}})},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"watchPoint"},[n("div",{staticClass:"head"}),e._v(" "),n("div",{attrs:{id:"watchMap"}}),e._v(" "),n("transition",{attrs:{name:"fade"}},e._l(e.infoBox,function(t){return n("div",{key:t.id,staticClass:"infoBox"},[n("img",{attrs:{alt:"标题图",src:t.src}}),e._v(" "),n("span",{attrs:{id:"topic"}},[e._v(e._s(t.topic))]),e._v(" "),n("span",{attrs:{id:"content"}},[e._v(e._s(t.content))])])}),0),e._v(" "),n("AlertTip",{directives:[{name:"show",rawName:"v-show",value:e.hasAlert,expression:"hasAlert"}],attrs:{"alert-text":e.alertText},on:{closeAlert:e.close}}),e._v(" "),e.hasPointMessage?n("pointInfo",{attrs:{pointInfo:e.pointInfo},on:{closePointMessage:e.close,deletePoint:e.deletePoint}}):e._e()],1)},staticRenderFns:[]};var h=n("VU/8")(m,f,!1,function(e){n("TP65")},"data-v-5a5b33f3",null);t.default=h.exports},PFOP:function(e,t,n){"use strict";var a=n("Xxa5"),s=n.n(a),i=n("exGp"),o=n.n(i),r=n("//Fk"),c=n.n(r),l=n("P9l9"),d={name:"model",components:{alertTip:n("Za1Y").a},props:{lat:"",lng:""},data:function(){return{topic:"",content:"",hasAlert:!1,alertText:"",info:"",files:[],index:0,maxLength:9,maxSize:1024e4}},methods:{selectImg:function(){var e=this,t=this.$refs.file.files;if(t.length>9)return this.hasAlert=!0,this.alertText="最多同时上传9张图片",0;for(var n=function(n,a){var s={id:e.index++,name:t[n].name,size:t[n].size,file:t[n]},i=new FileReader;i.onloadend=function(t){e.getBase64(t.target.result).then(function(t){e.$set(s,"src",t)})},s.size>e.maxSize?(e.hasAlert=!0,e.alertText="文件大小不能超过10MB"):(i.readAsDataURL(t[n]),e.files.push(s))},a=0,s=t.length;a<s;a++)n(a);this.files.splice(9)},getBase64:function(e){var t=new Image,n="";return t.src=e,new c.a(function(e,a){t.onload=function(){var a=document.createElement("canvas"),s=t.width,i=t.height,o=s/i,r=i,c=s;(s>100||i>100)&&(s>i?(c=100,r=100/o):(c=100*o,r=100)),a.width=c,a.height=r,a.getContext("2d").drawImage(t,0,0,c,r),n=a.toDataURL("image/jpeg",.5),e(n)}})},close:function(){this.$emit("close"),this.files=[]},closeAlert:function(){this.hasAlert=!1},confirm:function(){var e=this;return o()(s.a.mark(function t(){var n,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={topic:e.topic,content:e.content,lat:e.lat,lng:e.lng,url:e.files.src},t.next=3,l.a.sendPoint(n);case 3:(a=t.sent).tip?(e.hasAlert=!0,e.alertText=a.tip):"成功"!==a.data.response.message?(e.hasAlert=!0,e.alertText=a.data.response.message):"成功"===a.data.response.message&&(e.files=[]),e.$emit("makePoint");case 6:case"end":return t.stop()}},t,e)}))()}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"fade"}},[a("div",{staticClass:"fullScream"},[a("div",{staticClass:"model"},[a("div",{staticClass:"modelCenter"},[a("div",[a("label",{attrs:{for:"topic"}},[e._v("名称")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.topic,expression:"topic"}],attrs:{name:"topic",id:"topic",type:"text"},domProps:{value:e.topic},on:{input:function(t){t.target.composing||(e.topic=t.target.value)}}})]),e._v(" "),a("hr"),e._v(" "),a("div",[a("label",{attrs:{for:"content"}}),e._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],attrs:{placeholder:"输入文字...",name:"content",id:"content",type:"text"},domProps:{value:e.content},on:{input:function(t){t.target.composing||(e.content=t.target.value)}}})]),e._v(" "),a("div",{staticClass:"selectImg"},[a("img",{attrs:{alt:"选择图片",src:n("9Jd5")}}),e._v(" "),a("input",{ref:"file",attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:function(t){return e.selectImg()}}})]),e._v(" "),a("div",{staticClass:"previewImg"},e._l(e.files,function(e){return a("div",{key:e.id},[a("img",{attrs:{src:e.src,alt:"预览图"}})])}),0)]),e._v(" "),a("div",{staticClass:"modelFoot",attrs:{align:"center"}},[a("button",{staticClass:"confirm",on:{click:e.confirm}},[e._v("确认")]),e._v(" "),a("button",{staticClass:"close",on:{click:e.close}},[e._v("关闭")])])]),e._v(" "),a("alertTip",{directives:[{name:"show",rawName:"v-show",value:e.hasAlert,expression:"hasAlert"}],attrs:{"alert-text":e.alertText},on:{closeAlert:e.closeAlert}})],1)])},staticRenderFns:[]};var u=n("VU/8")(d,p,!1,function(e){n("5VmE")},"data-v-a0bee746",null);t.a=u.exports},TP65:function(e,t){},qOqC:function(e,t,n){"use strict";var a=n("Xxa5"),s=n.n(a),i=n("exGp"),o=n.n(i),r=n("P9l9"),c={name:"PointInfo",components:{alertTip:n("Za1Y").a},data:function(){return{watcher:!0,editTopic:this.pointInfo.data.topic,editContent:this.pointInfo.data.content,hasAlert:"",alertText:""}},props:{pointInfo:{type:Object}},methods:{closeAlert:function(){this.hasAlert=!1},close:function(){this.$emit("closePointMessage")},edit:function(){this.watcher=!1},changeWatcher:function(){this.watcher=!0},deletePoint:function(){this.$emit("deletePoint"),this.close()},sendNewPoint:function(){var e=this;return o()(s.a.mark(function t(){var n,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={topic:e.editTopic,content:e.editContent},t.next=3,r.a.sendNewPoint(n);case 3:(a=t.sent).tip?(e.hasAlert=!0,e.alertText=a.tip):"成功"!==a.response.message?(e.hasAlert=!0,e.alertText=a.response.message):"成功"===a.response.message&&e.$emit("closePointMessage");case 5:case"end":return t.stop()}},t,e)}))()}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fullScream"},[n("div",{staticClass:"model"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}]},[n("div",{staticClass:"topic"},[e._v(e._s(e.pointInfo.data.topic))]),e._v(" "),n("div",{staticClass:"content"},[e._v(e._s(e.pointInfo.data.content))])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}]},[n("div",[n("label",{attrs:{for:"topic"}},[e._v("标题")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editTopic,expression:"editTopic"}],attrs:{name:"topic",id:"topic",type:"text"},domProps:{value:e.editTopic},on:{input:function(t){t.target.composing||(e.editTopic=t.target.value)}}})]),e._v(" "),n("div",[n("label",{attrs:{for:"content"}},[e._v("内容")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.editContent,expression:"editContent"}],attrs:{name:"content",id:"content",type:"text"},domProps:{value:e.editContent},on:{input:function(t){t.target.composing||(e.editContent=t.target.value)}}})])]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.close}},[e._v("关闭")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.edit}},[e._v("编辑")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}],on:{click:e.sendNewPoint}},[e._v("确定")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:!1===e.watcher,expression:"watcher === false"}],on:{click:e.changeWatcher}},[e._v("取消")]),e._v(" "),n("button",{directives:[{name:"show",rawName:"v-show",value:e.watcher,expression:"watcher"}],on:{click:e.deletePoint}},[e._v("删除")])]),e._v(" "),n("alertTip",{directives:[{name:"show",rawName:"v-show",value:e.hasAlert,expression:"hasAlert"}],attrs:{"alert-text":e.alertText},on:{closeAlert:e.closeAlert}})],1)},staticRenderFns:[]};var d=n("VU/8")(c,l,!1,function(e){n("vdFE")},"data-v-4208f2fc",null);t.a=d.exports},vdFE:function(e,t){}});
//# sourceMappingURL=2.4102e01460363763666f.js.map